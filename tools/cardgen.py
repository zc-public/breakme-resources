#!/usr/bin/env python3
# /// script
# requires-python = ">=3.13"
# dependencies = [
#     "pycryptodome",
# ]
# ///

# python3 cardgen.py | grep difficulty | sort -n -k 7 | head -n1


from Crypto.Cipher import DES3


def parse_bytes(name, hex_str, length=None):
    """
    Parses a hex string into bytes, optionally enforcing a fixed length.
    """
    data = bytes.fromhex(hex_str)
    if length is not None and len(data) != length:
        raise ValueError(f"{name} must be {length} bytes (got {len(data)}).")
    return data


def des_ede_cbc_decrypt(key, data, iv):
    """
    Decrypts data using the specified 16-byte 2-key 3DES key in CBC mode.
    """
    cipher = DES3.new(key, DES3.MODE_CBC, iv=iv)
    return cipher.decrypt(data)


def des_ede_cbc_encrypt(key, data, iv):
    """
    Encrypts data using the specified 16-byte 2-key 3DES key in CBC mode.
    """
    cipher = DES3.new(key, DES3.MODE_CBC, iv=iv)
    return cipher.encrypt(data)


def main():
    challenges_25 = {'23A7CA555E7A1079': 1, 'B9796B3EAFB750E5': 7, '39214C7C118A73A2': 4, '0AA5EAFD80683913': 1, 'D7F30CF00F7DA3B3': 1, '6E571F2DB7241F22': 3, '1FDC89208CF0DCE7': 5, 'D4C076B11BA9E97E': 4, 'E129FF4E18410AAB': 6, '0F2C4FDB0D602391': 3, '3882C1C1F97045B4': 2, '8B86F6C10C1DF880': 5, 'DBDE91C6CD383CE0': 1, '9036C6072D8434EE': 2, '2161037553EA803C': 2, '8B71ACFD5CD1D8E2': 7, 'ABEF3E76E0C675FE': 2, 'FBEA3BCA5BDDF9D8': 8, '8F61619FB28915DF': 4, '0C01071B3AD6A72A': 3, '81456D8715AD3FDD': 5, 'AF43C24347C451CC': 9, 'C001B1E1C2C914CD': 11, '25BED993E2F007A2': 2, 'ADD61B326939BFC9': 3, '0A127A1959515DA3': 1, 'F8A0D2F1A20F5D22': 1, '4D60EC880F74CC61': 7, 'A0D8965767A869A7': 4, '8677FE5A24034F09': 7, 'F8C608177FBD450C': 7, 'C1CCB90EF62CA732': 2, '5D0B9D3065A20B98': 4, 'C6A26B3A00FA226A': 1, '3EB6CF8A2F920ECD': 9, '142B5B668EEBFE0F': 1, '339DBDFB7A88B516': 5, 'C31343CAABE4F47B': 8, 'DD2B08A1E1C99B90': 7, '4E30B96FEC9B298F': 7, '9CE78E6D35368927': 2, '5874C78C0AB0739B': 5, 'E822336A2E9ECFE1': 5, 'B98D7EF9D8A0A92C': 2, 'B0752F446B43196B': 7, '6E8DDFB77FADC4D2': 5, '54ECEFD675609433': 2, '50BA6E6C0C23AA73': 1, '2C39A2F06A8542BE': 2, '10C0C69B5BEC9A5E': 3, '65AF98AC123BDE96': 2, '71F0B6ED0319CD9C': 7, 'D442E76C1EF76116': 4, '4F7ADF7BE08D8004': 8, '544B308CD8D0A487': 2, '856A404864AF2B2E': 3, 'FBF08DF7FE599653': 1, '26142BE04BEAEA02': 4, '4E009CEF45D64819': 1, '27931A3CF3A68B57': 1, '95B85674DA5E4341': 3, '9D6AF716356CA946': 2, '62C92E974CEEED3D': 2, '7CDDB56686D5D67B': 1, '0634451819AF5B57': 4, '7455C78AE35A83AC': 5, 'FF439F6B9B34BA5A': 1, 'D92345888F764842': 4, 'F52638B520983B7F': 3, 'A2ED0D8EA4C8CB82': 3, '329FEE2CA306D911': 1, '4294BCE36D244A03': 3, '83E3B89AE35E47D4': 3, 'E1B82D2B8CD127D0': 7, '33A9A3859491291D': 4, '2CC25D2D3FAF1306': 1, 'DDD6E73CC1126C3E': 5, '6128FAA675598D33': 1, '0962D1A941C4935B': 4, '1299D2519823B619': 9, '3BAF1896302903BE': 1, 'D6D3BF85B0155C7D': 2, 'AE5CA27F40E6F8D4': 2, '6918F7373AE72894': 4, 'C507C2A9D7C14FC6': 2, 'D1FB094C2D5F66A5': 4, 'AB3AA74F0973CB1F': 2, '87ACD3A15A39CA07': 4, '41FE0795B6B9CF89': 2, '1D5CC41D3F2C82E4': 2, 'EC02B32ADCADDE94': 1, 'A25080DD7F8B92E0': 3, 'D3950DF9C68FADAD': 1, '7EC9A60B435644CD': 1, '63E0366174AED988': 2, '955EA740CAEE3C3C': 2, 'B6DFB7CC44E62391': 1, '8359AA273FE83368': 2, 'B9E42293B3A9178C': 1, '140A79230BEEECBA': 4, '76B302EB05E90D6C': 1, '618DDB9B7CFF9088': 3, 'FE77BB033460A0D1': 2, 'BC7D527B10A47533': 3, '920FA672164A44EA': 1, '40292AE237445501': 3, '954E70993B854489': 3, '93591791BBC8A84E': 5, '93AEEAA1CE4D26B5': 3, '74F5F6BF764B35B6': 2, '2C774DC17FA80F65': 2, '435BEB3941C62AFF': 6, 'EF45C0C704E4BC92': 1, '5337ED0CAFF7295E': 3, '688B8D074679F5A5': 6, 'DA90F32BE7D59749': 4, '0B14931A61962B13': 2, 'AA11AAD09F3B5F58': 9, 'FB00692C9FD4AF12': 2, 'FAFD1B7CE9D18F79': 1, '8DAA30E388A9D59B': 2, 'E6F4C6DA127C4D6E': 3, '94373EAB54B55319': 5, '9CDCA10C37F84A54': 3, 'EDCD3F260110B90E': 2, '77C64582AF7ADA61': 3, '2D09791EC5B27BA3': 2, 'A57DC4E2ACB8B1E6': 5, '742979DA55E3A36D': 1, 'BF270C8A9EB6F308': 2, '5959321069082548': 1, 'B0AD269DE2C8CE9F': 1, '2DEADF91789CE825': 4, '3A38FE7563BECB13': 3, '5970C1F6E4573A0C': 2, '2F8B244F280D4245': 3, 'D2114D87E525CE17': 4, '945E0ABFCFBF65FD': 1, '25A7A7F70F942740': 1, '59E23EBD8A38A529': 1, '4E93B0BE8A7F402A': 3, 'A01AD0BB75C59B7F': 3, 'B2EC8881CF3C04CF': 2, 'DD09AF7CDEC65523': 2, '97480939DB8A128C': 2, 'FA3F1336D4EE44E9': 2, '64E9B832C75AC3D4': 1, '2973DA9F7EF2CE41': 8, '983E75F26DD23732': 2, 'E8AAC6FB9FF8966B': 2, '13B822AF5FCC4039': 1, 'A1783EDF4AB6D508': 2, '62B3D52D5B625AB0': 4, '382F055944FB4595': 1, '2AC8D904AA17667F': 4, '9CD301096ACECEA4': 5, '5248794837590943': 1, 'C657E520168045D7': 1, 'B0D0DB022CE1D974': 5, '6752157D56AD9BBB': 3, 'F6E25D1BC009096B': 2, 'D14E83D8FDE86C80': 9, 'A06970F632F7112E': 1, 'B2D999927560DE96': 2, '2F94412D0FBB11FC': 7, '2C6C8AE8E155D89B': 4, '960718BBF62DFD58': 1, 'F572C8A3D21FC333': 3, '8EDAF79C21376E53': 5, '2C2003E85CBA7617': 1, '19218AB2D3D8F05F': 1, '09B139B1475E909C': 5, '6FBF04D7CA261C18': 1, 'A2B867EB60DE61EB': 2, '4DCE78BA3FE75CE6': 5, 'D9BEAAD9F98101AE': 2, 'B6E32D6190D58DAE': 3, '690341F4037F05E5': 3, '3D720546C791A4DC': 2, '41623489C9A32B07': 1, 'A0C01B3CFCE81ED4': 4, '545488C225ED9C93': 2, 'F376A70AD21888A9': 1, 'A0188ABD4D1FC84A': 3, 'CFA83A4761FFD63A': 4, '9FEB557219E4A3E0': 2, 'B06CA4C7B7A70034': 1, '169D38FC0917D35B': 4, '38AA9BFA88E7FE2D': 2, 'FABF2A79B19675CB': 2, '2D4F214D755562E9': 3, '5218A160E15F793C': 3, '7B792565FFBE789B': 2, '98EB3857394B55B0': 4, 'DBE1CBA8162D3329': 2, 'EE291E4D903CD7AE': 3, 'AFB6C5E6D2C57823': 3, '88AA890093C8AF8D': 1, 'ADC116ACFB863215': 3, 'AB79B84F03E983D5': 5, '4B218F080AED2BDB': 1, '8C2BFF85CB90D1B6': 2, '7BC13B32EECEF7A2': 4, 'F217FAF8D09A4D07': 3, '0239E9137FBEC038': 1, 'DDC300B43C1F32A1': 3, 'F7F60B47A1A6017D': 4, '75DE5378CB5F8C88': 2, 'B8E5F0D7BFD96AF0': 1, '503A5CB196697D9B': 7, 'D3FD54EC73E3D652': 3, 'CEECF5E4E2BC5261': 3, '9E8D45A30BE365EC': 2, '7B09223D10AB925B': 1, '85C0651BBB744DB4': 1, '2512C8C662AFE6C3': 2, '3ED31DA36E126294': 4, '4EB67AB925030E94': 5, 'A257EBBE17D9D1F4': 1, '571C804218A3F64C': 3, '7036654FB250174D': 2, 'D56EE461ED5ABE01': 2, '23F222B76064DABE': 2, 'B736F7A32C58FCA5': 1, '91BA695E2C3C1F6B': 5, 'A08A7227585CA4BC': 2, '7A07837650A479C6': 2, '3C9384FF1E2BA56D': 3, '6EFCE247E09A3DD6': 1, 'C45B453BEBBCE00A': 1, '391B461709694C05': 2, '1FD90DED47835DA1': 1, 'D2DD53F9AE9510A2': 1, '6AFBE32C721AA0A1': 2, '46DB7867C062847B': 5, '1C58ECD96B4A85A6': 3, '70D34362C962D9B7': 1, 'EE50216AC733ADA7': 4, '57BEEE774B73844F': 1, '6B5C55369E507803': 1, '3C87FEFF63ADEF6C': 3, 'F5195F73490844FB': 6, '6DF7EBCA0F753268': 2, '0D1498081278FFBB': 1, 'A0CAC14BC9018E47': 5, '3D70AFE05A26142A': 6, 'C349786B33EF5F9E': 4, 'B1D8BAD2DF46CC5F': 2, '34FFEADA8D5CD399': 3, 'B681CDC5DF208B61': 1, '8DF5904FF4F4C0CC': 2, 'B46C2C572869A366': 2, '239E410E7E315A1A': 1, '0F38C2918C1AB730': 1, 'A5D517A3068B76BB': 2, '7EEEDD25FA05C296': 3, 'C31B5FB386297E65': 6, '3145606F0758E505': 3, '3FF7F2AEEE430F73': 1, '0A4041674FC81A7E': 1, '5F79D431C8CFAAB6': 2, '9A8EC8B3BBBB0174': 5, '68A955143C0A278D': 2, '295A638ACDF494BC': 1, '2C5A8EB8AF4A37B4': 1, '0D4AEB10938B9C57': 1, '48C22BED84FD6B13': 1, '917005E67BC7E7DE': 1, '7C43443432D26DF5': 1, '90EC2B3BF9684EA1': 3, '41ACC7F7BB23D248': 2, '76B0E1A4FF85AEA5': 2, '675CBD7238C8963E': 2, 'CDBD334D83C8EEE0': 2, '08161EA0209D1DA6': 3, '0429C0DC6077E663': 1, '9541510AA4CC31F3': 3, '48040876F5CBCEFD': 4, '5F6909C43BC40449': 1, '741A0BE4C1E58222': 1, '7DC883122EB8E0D8': 1, '88F4AD363FE4427D': 1, '1CFE72DE56A55DCE': 1, 'A0A20DC707282B33': 1, '1B59C94683621431': 5, '0AA814C8DAA828E9': 1, '03AD359240E1A07B': 2, '4C5054DECF3E22C5': 1, 'CF729F03B3B2B96F': 6, '6178B0B4D1753565': 2, '4A9A4A10D31CDA46': 1, 'D95C0D201F0CDAA0': 2, 'C94133DD60441DC2': 3, 'EDEC3A919AFC70A6': 2, 'D3507364A19363A4': 1, 'B61DB629A7A0CB92': 2, 'DDBF2411482D4790': 1, 'BD752A1FC98FBBAE': 3, '48BD6EF334C77962': 2, '6DD274FAA990AE93': 1, '93B3B66420BE157C': 3, 'AE52A589AC048283': 2, 'E60CC2BDD60C4E21': 1, '08EA110C7B0EB0E2': 2, 'A4C3E33B03AF6906': 1, 'A0FA2F18E9E4D717': 1, '13C6A45E295AD0A0': 1, 'C3092763F27B2836': 3, '02419DE99A670423': 1, '8CDAB6CCCEF99919': 3, '3F3A05F11FD09462': 1, '6B92AB1559552538': 1, 'F532612BC23F5461': 2, '41E7AEE436A43421': 1, '04467D83C502F4DA': 1, 'E05427D80ABAD6CD': 4, 'D81FA76B4FCE80D1': 3, 'B678CCE22AC7A078': 1, '8167E08ED93AE767': 1, '6F54DC79CCB92272': 1, 'E4BCA12FEAE9DB10': 1, '31E940B14343094F': 1, 'E1641F6B410F33BF': 1, '8B49EDC220498595': 3, 'C183BBE921DC1D39': 3, '7354B4B11CF36C1E': 1, '4CBC06B989E4E28D': 1, 'EB67D95C90DF631B': 1, 'E966C8D7215CC006': 1, 'B489C6435A46ACEC': 2, '7E32377D223CD1B9': 1, '4729F2D77BE304B4': 1, '25D1924DF2E534D5': 1, 'A808D1B418F68227': 1, '0FE557BCF5B3F452': 2, '541E2742BE4D5206': 2, 'F6FD9AB17149CDB4': 1, '1D9E7D1C6EEDF91C': 1, '9AB59C184CE3E0D7': 1, '6ACEB8BA4A69723B': 2, '9EE9D08F4FE75F0A': 2, '7F67A89D36EDAB9D': 2, 'A84AA60373B5EA57': 3, '8C17A928D7885988': 1, '33414B99CF53C369': 1, '8ADB87574B3CF67A': 1, '6C669006F46EA755': 1, 'E5A5A18ED902F4FE': 3, '59E3447C3F72E615': 1, '67DAB9750A137D55': 1, 'E0C79F207BD2C453': 1, '55FAC8E2EBCD8211': 1, 'F88F1733F5FC9908': 1, '2BFFD5A5F41EC17B': 1, 'C100F444087B8F38': 2, '62CBB9ED352D17F3': 1, 'ED35194C49EFF5AB': 2, '78DA2A11F2B09F35': 2, '4FC20CACB063858C': 1, 'CC774CD679765570': 1, 'FECC39E4E4836EDD': 2, 'BCA64EBDB53A88D0': 1, '7C1AD6FBF267D440': 2, '6D5864B709FEAB7B': 1, 'B0B3298E6900BC3F': 1, '0393918F2AD9DEE1': 1, '525B2978EA17138D': 1, '126C8BA928B0CC73': 1, '7005DF233049F1E7': 2, 'F41323AEDEE0BDFA': 1, '79734FE3A3CC6BB1': 3, '3F698D195EF1189F': 3, '693395052DB34DC1': 2, 'D4A9BDFD6A7E1442': 1, '0723657A1806B567': 3, '0A8B117A72FBF09B': 1, 'C060EA0AF00EFBE4': 2, '7D10D769BDA08A46': 1, 'A27FBFB8134A26D6': 1, '6C3A208FEC59E5F5': 1, '4A6136AA5F98EAAB': 2, 'CA21CFC615EA70CF': 1, '168FCD39FB1DD523': 1, 'F5104282539C707C': 1, 'BE3CAB23C794A459': 1, 'DCAFA8C3E1A3E5D2': 1, 'A5822FC58BC66878': 1, '9CB5042C0DC15085': 1, '7809C5126AFC1D22': 1, '990C217385B854AB': 1, 'F2A7F3DB454DAFB2': 1, '00EF67F8DDEABD7F': 1, '2C0EDFA208CAE088': 1, '928F48D087BE65EA': 1, 'B789131250E0C986': 1, '8F20805EE5394BF7': 2, '3B0CECC1796F9A5A': 1, '87D4EF6124A01F5D': 1, '4032392C63A3100B': 1, 'D7C4CE68F0477773': 1, '320E4F68C275C4E2': 1}
    challenges_0 = {'6957B4ABDA546D2A': 2, '78323C181E0C0F07': 4, '2D6E16B78B5A45AC': 3, '417C20BF905FC82E': 2, '8783C3C1E1E1F0F1': 4, '8335C19BE0CDF066': 5, '8DA5C6D26369B1B4': 1, '4DD7A6EBD375E9BA': 4, 'D5C7EAE275703AB8': 1, 'D7AE6BD635EB9AF5': 7, 'AE7BD73C6B9E35CF': 8, 'B979DCBDEE5E772E': 1, '5511AA89D545EAA3': 1, '6BD635EB9AF5CD7A': 6, 'BD8BDEC46F63B7B0': 1, '1E0C0F078783C3C1': 5, '557DAABFD55FEAAE': 7, '105B882C4417A20A': 3, 'FCADFE57FF2BFF94': 4, 'F551FAA87D55BEAA': 3, '75703AB81D5C0EAF': 1, '2F239791CBC9E5E4': 1, '19C78CE246702338': 1, 'E561F2B1F959FCAD': 3, '6BBA35DD9AEFCD77': 3, 'E1DC70EFB877DC3B': 1, '59AFACD6566BAB35': 4, '4B1FA58FD2C66962': 1, 'ABE055F1AAF8557D': 3, '3C181E0C0F078783': 5, '7C3A3E1D9F0E4F86': 2, '9D544EAA275413AA': 3, 'D7746BBA35DD9AEF': 4, '6289B145D8A3EC51': 1, '0400020001000080': 1, '044E02278113C088': 3, 'AB5055A82AD5956A': 3, '5A002D0016800B40': 2, 'FE57FF2BFF947FCB': 5, '7EFE3F7E1FBE0FDF': 3, '58ADAC57D62BEB14': 3, '06418321C19060C9': 1, '92DFC96E64B7B25A': 2, 'C19BE0CDF0667832': 9, '089C044E02278113': 1, '8000400020001000': 3, '9C7A4E3C271E138F': 2, '73DFB9EE5CF7AE7B': 4, '58DBAC6C56362B1A': 3, '7D81BEC05F61AFB1': 5, 'A16BD0B5E85BF42C': 1, '5CF7AE7BD73C6B9E': 5, 'DFF3EFF9F7FDFBFF': 5, '320A19040C820641': 1, '774DBBA65DD3AEE9': 1, '4E3C271E138F89C6': 4, 'A1FBD0FC687FB43E': 1, '02278113C0886045': 4, '0FDF87EE43F7A1FB': 4, '80104009A005D002': 3, 'D0026801B4005A00': 2, '13AA09D404EA0275': 3, '3F7E1FBE0FDF87EE': 3, '44E222701138089C': 4, '7E6BBF35DF9BEFCD': 7, 'AB35D59BEACDF566': 3, 'B7D45BEA2DF596FA': 3, '8FD5C7EA63F5B1FA': 3, '066B8335C19BE0CD': 5, '89C644E222701138': 2, '9AF5CD7A66BC335E': 7, 'A7B853DC29EF94F7': 2, 'E9BA74DDBA6FDD37': 4, '55E62AF215798ABD': 3, 'C56262B0315998AD': 2, '55A82AD5956A4AB5': 4, 'D73C6B9E35CF9AE7': 3, '0016000A00040002': 3, 'F7FDFBFFFDFE7EFE': 2, 'BCC45E63AF305799': 4, '6B9E35CF9AE7CD72': 4, '8AC9C56462B3B158': 2, 'BFE5DFF3EFF9F7FD': 1, 'E7BE73DFB9EE5CF7': 4, '9AE7CD7266B9B35C': 3, '56362B1A158D8AC7': 4, 'C7ABE3D471EA38F5': 3, '57C3ABE055F1AAF8': 1, 'F22C7917BC8A5E44': 1, 'FABA7D5DBEAFDF56': 1, 'B15858ADAC57D62B': 1, '8C54462A2314118B': 2, '52C8296414B38A58': 2, '75A3BAD1DD686EB4': 2, '416820B4105B882C': 2, '1138089C044E0227': 6, '02F4017A00BC005E': 3, '6045B023D811EC09': 5, 'A50E5286294394A0': 1, 'D49FEA4FF527FA93': 2, '35DD9AEFCD77E6BB': 3, 'BD7C5EBFAF5FD7AE': 7, 'D0FC687FB43E5A1F': 6, '4463A2305119A88C': 5, '798BBCC45E63AF30': 4, 'B43E5A1FAD0FD686': 3, '2C7F963E4B1FA58F': 2, '85AC42D7A16BD0B5': 2, 'AF8657C3ABE055F1': 2, '7FCBBFE5DFF3EFF9': 2, '138F89C644E22270': 6, 'C3C1E1E1F0F1F878': 7, '2AF215798ABDC55E': 4, 'D14A68A5B4525A29': 1, 'AFB1D7D9EBEDF5F6': 5, 'F0F1F8787C3DBE1E': 6, '62B0315998ADCC57': 6, '38F59C7A4E3C271E': 1, 'EFCDF7E67BF23DF9': 2, 'F527FA93FD487EA4': 1, 'BD0A5E842F4217A0': 3, '5F0FAF8657C3ABE0': 2, '7D5DBEAFDF566FAB': 2, 'D3FFE9FE74FE3A7E': 2, '2B079583CAC1E561': 3, 'A55BD2AC6957B4AB': 2, '5BD9ADEDD6F66B7B': 2, 'F314798BBCC45E63': 3, '7C3DBE1E5F0FAF86': 5, '70EFB877DC3BEE1D': 2, 'E62BF314798BBCC4': 3, '35CF9AE7CD7266B9': 5, 'D811EC09F605FB02': 6, 'FB027D81BEC05F61': 3, 'DF9BEFCDF7E67BF2': 1, 'B023D811EC09F605': 2, '35EB9AF5CD7A66BC': 4, '62AE315618AB8C54': 6, '275413AA09D404EA': 2, 'D55FEAAE75563AAB': 4, '14B38A58452DA297': 2, 'E5E472F3B979DCBD': 2, '335E19AE0CD6066B': 5, '7BF23DF99EFDCF7F': 1, '22701138089C044E': 4, '82FA417C20BF905F': 2, 'EC09F605FB027D81': 3, '5119A88C5447AA22': 3, '55F1AAF8557DAABF': 3, '42D7A16BD0B5E85B': 2, 'F35DF9AFFCD67E6B': 4, '2B2215918AC9C564': 2, '8F57C7ABE3D471EA': 3, 'DD686EB4375B9BAC': 2, 'E45BF22C7917BC8A': 2, 'F9AFFCD67E6BBF35': 3, '0F078783C3C1E1E1': 4, 'FF947FCBBFE5DFF3': 3, '315618AB8C54462A': 3, 'EB14758BBAC45D63': 3, '566BAB35D59BEACD': 4, 'AEE9D7746BBA35DD': 3, 'FCD67E6BBF35DF9B': 4, 'D2C6696234B01A59': 1, '527DA93FD49FEA4F': 3, 'ACD6566BAB35D59B': 1, 'ABCC55E62AF21579': 2, 'AD4056A1AB5055A8': 4, 'AF5FD7AE6BD635EB': 4, '9EFDCF7FE7BE73DF': 2, '118B88C44463A230': 3, 'D0B5E85BF42C7A17': 4, '2FAA17D40BEA05F5': 2, '00BC005E002E0016': 2, '19AE0CD6066B8335': 5, '0B4005A182D04168': 2, '2318118C08C78462': 1, 'EBEDF5F67AFBBD7C': 4, '964A4B25A59252C8': 1, '5799ABCC55E62AF2': 4, 'EE5E772E3B961DCA': 2, 'F06678323C181E0C': 4, 'D545EAA3F551FAA8': 2, 'B5A05AD02D6816B4': 2, '0C8206418321C190': 1, '5E842F4217A00BD0': 4, 'EE9A774DBBA65DD3': 2, '471E238F91C648E2': 1, '0275813A409DA04E': 4, 'BA6FDD37EE9A774D': 2, 'FA93FD487EA43F52': 1, '6369B1B458DBAC6C': 5, '46322318118C08C7': 1, 'B4ABDA546D2A3694': 4, 'F70E7B863DC39EE0': 1, 'A2305119A88C5447': 3, 'CD77E6BBF35DF9AF': 3, '0CD6066B8335C19B': 7, '8ABDC55E62AE3156': 7, 'BE1E5F0FAF8657C3': 6, 'D68BEB4475A3BAD1': 2, '4A5025281295894B': 1, 'B0645833AC18560C': 1, '7AFBBD7C5EBFAF5F': 3, '5BEA2DF596FA4B7C': 1, '7D55BEAA5F542FAA': 1, 'AB8DD5C7EAE27570': 2, 'B4525A29AD15D68B': 1, '2C97964A4B25A592': 2, '7A17BD0A5E842F42': 5, 'CF7FE7BE73DFB9EE': 3, 'C55E62AE315618AB': 2, '4AB5A55BD2AC6957': 3, '6416320A19040C82': 2, '0080004000218010': 1, '4EAA275413AA09D4': 4, 'A04E5027A813D408': 2, 'EAEBF575FABA7D5D': 1, '000A000400020001': 1, '0BEA05F582FA417C': 4, 'AF305799ABCC55E6': 3, '36A99B55CDAA66D4': 1, 'C8B5E45BF22C7917': 2, '1DCA0EE58773C3B9': 1, 'B9EE5CF7AE7BD73C': 3, '15798ABDC55E62AE': 2, 'CD7A66BC335E19AE': 2, '43F7A1FBD0FC687F': 3, '5E63AF305799ABCC': 2, 'DCBDEE5E772E3B96': 2, 'AD15D68BEB4475A3': 1, 'AAF8557DAABFD55F': 2, '18AB8C54462A2314': 6, 'EAAE75563AAB9D54': 1, '05A182D0416820B4': 1, '592C2C97964A4B25': 2, 'E3D471EA38F59C7A': 2, 'DF566FABB7D45BEA': 3, 'BBA65DD3AEE9D774': 3, 'F8747C3A3E1D9F0E': 1, '4B25A59252C82964': 2, '9FF24FF9A7FDD3FF': 1, 'D4086A05B5025A81': 1, 'FBFFFDFE7EFE3F7E': 2, '8AC7C56262B03159': 4, 'F959FCADFE57FF2B': 2, '5447AA225511AA89': 1, 'E34A71A5B8D25C69': 1, '8113C0886045B023': 2, '3AAB9D544EAA2754': 3, 'D6F66B7BB5BC5ADE': 1, '3D581EAD8F57C7AB': 3, '87EE43F7A1FBD0FC': 2, '158D8AC7C56262B0': 3, '05E802F4017A00BC': 2, 'F6287B15BD8BDEC4': 4, '66BC335E19AE0CD6': 9, '18CD8C6646322318': 1, '687FB43E5A1FAD0F': 5, '45AC22D7916BC8B5': 1, 'EE1DF70E7B863DC3': 1, 'AC57D62BEB14758B': 1, '88C44463A2305119': 3, '315998ADCC57E62B': 3, 'D7D9EBEDF5F67AFB': 5, '0200010000800040': 1, '3E1D9F0E4F8627C3': 1, 'D59BEACDF5667AB2': 3, '916BC8B5E45BF22C': 3, 'E0CDF06678323C18': 5, '0EE58773C3B9E1DC': 2, '00918049C0246012': 1, 'E6BBF35DF9AFFCD6': 5, 'A1D450EA2875943A': 2, 'BEAA5F542FAA17D4': 4, '874FC3A7E1D3F0E9': 1, 'EAA3F551FAA87D55': 2, 'C82E6416320A1904': 1, '2D6816B40B5B85AC': 1, '271E138F89C644E2': 1, '956A4AB5A55BD2AC': 2, '2B1A158D8AC7C562': 2, '08CE046782324118': 1, '75563AAB9D544EAA': 2, 'A20A510428821441': 2, '15918AC9C56462B3': 1, '002E0016000A0004': 4, 'AC8E56462B221591': 1, '3F521FA98FD5C7EA': 1, 'BAC45D63AEB05759': 2, '772E3B961DCA0EE5': 1, 'ADEDD6F66B7BB5BC': 1, '58FC2C7F963E4B1F': 1, '905FC82E6416320A': 1, '49F1A4F8527DA93F': 2, '60C9B0645833AC18': 1, '20BF905FC82E6416': 2, '08C7846242302119': 1, 'F8787C3DBE1E5F0F': 4, '0040002180104009': 1, 'CAC1E561F2B1F959': 2, '8B5A45AC22D7916B': 2, '6D2A36941B4B8DA5': 1, 'D6866B43B5A05AD0': 1, 'DD37EE9A774DBBA6': 2, '0800040002000100': 1, '17D40BEA05F582FA': 3, '8A21C5106289B145': 1, '7B863DC39EE04F71': 1, '208C104788224411': 2, '94A04A5025281295': 1, '5759ABADD5D7EAEB': 1, '5A29AD15D68BEB44': 2, 'BEC05F61AFB1D7D9': 5, '4000200010000800': 1, '9EE3CF7067B833DC': 1, 'DA546D2A36941B4B': 2, '5027A813D4086A05': 4, '8321C19060C9B064': 3, 'E1E1F0F1F8787C3D': 4, '2314118B88C44463': 4, '71EA38F59C7A4E3C': 2, '6801B4005A002D00': 2, '5EBFAF5FD7AE6BD6': 2, 'F2B1F959FCADFE57': 2, '5F61AFB1D7D9EBED': 2, '005E002E0016000A': 5, '6A05B5025A81AD40': 1, '758BBAC45D63AEB0': 1, 'EFF9F7FDFBFFFDFE': 1, '19040C8206418321': 3, 'FDFE7EFE3F7E1FBE': 2, '6B43B5A05AD02D68': 2, 'D375E9BA74DDBA6F': 3, '14418A21C5106289': 1, 'D485EA4275203A90': 1, 'B5025A81AD4056A1': 1, 'B1B458DBAC6C5636': 3, 'C6D26369B1B458DB': 1, '3DF99EFDCF7FE7BE': 4, 'C96E64B7B25A592C': 1, 'C0886045B023D811': 3, '5D63AEB05759ABAD': 1, '4009A005D0026801': 1, '288214418A21C510': 1, '5AD02D6816B40B5B': 1, 'AABFD55FEAAE7556': 1, '696234B01A598D2D': 1, '16B40B5B85AC42D7': 2, '5833AC18560C2B07': 1, '9791CBC9E5E472F3': 1, '375B9BAC4DD7A6EB': 1, '3B961DCA0EE58773': 1, '0B5B85AC42D7A16B': 1, 'FAA87D55BEAA5F54': 1, '5ADE2D6E16B78B5A': 1, 'D5D7EAEBF575FABA': 2, 'AEB05759ABADD5D7': 1, '560C2B079583CAC1': 1, 'BF35DF9BEFCDF7E6': 3, '7EA43F521FA98FD5': 1, 'AC18560C2B079583': 1, 'F395F9CBFCE5FE73': 1, 'F605FB027D81BEC0': 1, '462A2314118B88C4': 1, '0BD005E802F4017A': 1, '7AB23D581EAD8F57': 1, 'D2AC6957B4ABDA54': 3, '9EE04F71A7B853DC': 1, '36941B4B8DA5C6D2': 1, 'B145D8A3EC51F628': 1, 'B6F65B7BADBC56DE': 2, '5A1FAD0FD6866B43': 1, '72F3B979DCBDEE5E': 1, 'F5F67AFBBD7C5EBF': 2, '729E394F9CA7CE53': 1, '16B78B5A45AC22D7': 1, '22D7916BC8B5E45B': 1, 'D62BEB14758BBAC4': 1, '1C7B8E3C471E238F': 1, '8EA4475223A991D5': 1, 'F7E67BF23DF99EFD': 3, '6EB4375B9BAC4DD7': 1, '17A00BD005E802F4': 2, '98ADCC57E62BF314': 1, '0002000180004000': 1, '68A5B4525A29AD15': 2, '7917BC8A5E442F23': 1, '75203A901D498EA4': 1, '017A00BC005E002E': 2, 'A813D4086A05B502': 2, 'B1FA58FC2C7F963E': 1, '19B58CDBC66C6336': 1, '1D3E0E9F874FC3A7': 1, '9F0E4F8627C393E0': 1, '29EF94F7CA7BE53C': 1, '56A1AB5055A82AD5': 1, 'A88C5447AA225511': 1, '9BAC4DD7A6EBD375': 1, '813A409DA04E5027': 1, '16800B4005A182D0': 1, '05F582FA417C20BF': 1, '6E89B745DBA3EDD1': 1, '25BF92DFC96E64B7': 1, 'ABADD5D7EAEBF575': 1, 'F575FABA7D5DBEAF': 1, '882C4417A20A5104': 1, '8A58452DA297D14A': 1, 'AA225511AA89D545': 1, '5DD3AEE9D7746BBA': 1, '5E442F239791CBC9': 1, 'F42C7A17BD0A5E84': 1, 'F9CBFCE5FE73FF39': 1}
    challenges_25_sorted_desc = dict(sorted(challenges_25.items(), key=lambda item: item[1], reverse=True))
    challenges_0_sorted_desc = dict(sorted(challenges_0.items(), key=lambda item: item[1], reverse=True))
    print("Top plaintexts:")
    print(list(challenges_0_sorted_desc)[0:20])
    print("Top observed challenges:")
    print(list(challenges_25_sorted_desc)[0:20])

    for plain_chal in challenges_0_sorted_desc:
        # Get PICC_ekRndB from command-line argument
        PICC_ekRndB_hex = plain_chal
        PICC_ekRndB = parse_bytes("PICC_ekRndB", PICC_ekRndB_hex, 8)

        # Default key (big-endian) used by MIFARE Ultralight C
        # "49454D4B41455242214E4143554F5946" -> "IEMKAERB!NACUOYF" in ASCII
        # keyBE_hex = "49454D4B41455242214E4143554F5946"
        keyBE_hex = "00000000414552420000000000000000"
        # keyBE_hex = "49454D4B000000000000000000000000"
        keyBE = parse_bytes("default_key", keyBE_hex, 16)

        # Decrypt PICC_ekRndB to get RndB
        # First encryption/decryption always uses an all-zero IV
        zero_iv = b"\x00" * 8
        rndB = des_ede_cbc_encrypt(keyBE, PICC_ekRndB, zero_iv)
        rndB_final = rndB.hex().upper()

        if rndB_final in challenges_25_sorted_desc:
            diff = ((list(challenges_0_sorted_desc).index(plain_chal)+1) *
                    (list(challenges_25_sorted_desc).index(rndB_final)+1))
            # Sane threshold
            if diff < 200:
                print(f"Found: {rndB_final} with plaintext {plain_chal} (difficulty: {diff})")


if __name__ == "__main__":
    main()
